# Prometheus Configuration for Chat4All v2
# T115: Scrape metrics from services running in Docker Compose
# T117: Alert rules configuration

global:
  scrape_interval: 5s
  evaluation_interval: 5s
  external_labels:
    cluster: 'chat4all-dev'
    environment: 'development'

# Alert rule files (T117)
rule_files:
  - '/etc/prometheus/alerts.yml'

# Scrape configurations
scrape_configs:
  # Chat4All microservices running in Docker Compose
  # Uses Docker Compose service names for DNS resolution
  - job_name: 'chat4all-services'
    metrics_path: '/actuator/prometheus'
    scrape_interval: 5s
    static_configs:
      - targets: 
          - 'api-gateway:8080'       # API Gateway
          - 'message-service:8081'   # Message Service
          - 'router-service:8082'    # Router Service
          - 'user-service:8083'      # User Service
          - 'file-service:8084'      # File Service
        labels:
          application: 'chat4all-backend'
          team: 'platform'

  # Platform connectors (Docker Compose service names)
  - job_name: 'connectors'
    metrics_path: '/actuator/prometheus'
    scrape_interval: 5s
    static_configs:
      - targets:
          - 'whatsapp-connector:8085'   # WhatsApp Connector
          - 'telegram-connector:8086'   # Telegram Connector
          - 'instagram-connector:8087'  # Instagram Connector
        labels:
          application: 'chat4all-connectors'
          team: 'platform'

  # Prometheus self-monitoring
  - job_name: 'prometheus'
    static_configs:
      - targets: ['localhost:9090']
        labels:
          application: 'monitoring'
